(()=>{"use strict";const e={};let t=!0,r=(e=500)=>{if(t){const r=document.querySelectorAll("[data-lp]");setTimeout((()=>{r.forEach((e=>{e.style.paddingRight=""})),document.body.style.paddingRight="",document.documentElement.classList.remove("lock")}),e),t=!1,setTimeout((function(){t=!0}),e)}};function a(e){setTimeout((()=>{window.FLS&&console.log(e)}),0)}function o(e){return e.filter((function(e,t,r){return r.indexOf(e)===t}))}let s=(e,t=!1,o=500,s=0)=>{const n=document.querySelector(e);if(n){let i="",c=0;if(t){i="header.header";const e=document.querySelector(i);e.classList.contains("_header-scroll")?c=e.offsetHeight:(e.style.cssText="transition-duration: 0s;",e.classList.add("_header-scroll"),c=e.offsetHeight,e.classList.remove("_header-scroll"),setTimeout((()=>{e.style.cssText=""}),0))}let l={speedAsDuration:!0,speed:o,header:i,offset:s,easing:"easeOutQuad"};if(document.documentElement.classList.contains("menu-open")&&(r(),document.documentElement.classList.remove("menu-open")),"undefined"!=typeof SmoothScroll)(new SmoothScroll).animateScroll(n,"",l);else{let e=n.getBoundingClientRect().top+scrollY;e=c?e-c:e,e=s?e-s:e,window.scrollTo({top:e,behavior:"smooth"})}a(`[gotoBlock]: Юхуу...едем в ${e}`)}else a(`[gotoBlock]: Ей... Такого блока нет на странице: ${e}`)};let n={getErrors(e){let t=0,r=e.querySelectorAll("*[data-required]");return r.length&&r.forEach((e=>{null===e.offsetParent&&"SELECT"!==e.tagName||e.disabled||(t+=this.validateInput(e))})),t},validateInput(e){let t=0;return"email"===e.dataset.required?(e.value=e.value.replace(" ",""),this.emailTest(e)?(this.addError(e),this.removeSuccess(e),t++):(this.removeError(e),this.addSuccess(e))):("checkbox"!==e.type||e.checked)&&e.value.trim()?(this.removeError(e),this.addSuccess(e)):(this.addError(e),this.removeSuccess(e),t++),t},addError(e){e.classList.add("_form-error"),e.parentElement.classList.add("_form-error");let t=e.parentElement.querySelector(".form__error");t&&e.parentElement.removeChild(t),e.dataset.error&&e.parentElement.insertAdjacentHTML("beforeend",`<div class="form__error">${e.dataset.error}</div>`)},removeError(e){e.classList.remove("_form-error"),e.parentElement.classList.remove("_form-error"),e.parentElement.querySelector(".form__error")&&e.parentElement.removeChild(e.parentElement.querySelector(".form__error"))},addSuccess(e){e.classList.add("_form-success"),e.parentElement.classList.add("_form-success")},removeSuccess(e){e.classList.remove("_form-success"),e.parentElement.classList.remove("_form-success")},formClean(t){t.reset(),setTimeout((()=>{let r=t.querySelectorAll("input,textarea");for(let e=0;e<r.length;e++){const t=r[e];t.parentElement.classList.remove("_form-focus"),t.classList.remove("_form-focus"),n.removeError(t)}let a=t.querySelectorAll(".checkbox__input");if(a.length>0)for(let e=0;e<a.length;e++){a[e].checked=!1}if(e.select){let r=t.querySelectorAll("div.select");if(r.length)for(let t=0;t<r.length;t++){const a=r[t].querySelector("select");e.select.selectBuild(a)}}}),0)},emailTest:e=>!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,8})+$/.test(e.value)};e.watcher=new class{constructor(e){this.config=Object.assign({logging:!0},e),this.observer,!document.documentElement.classList.contains("watcher")&&this.scrollWatcherRun()}scrollWatcherUpdate(){this.scrollWatcherRun()}scrollWatcherRun(){document.documentElement.classList.add("watcher"),this.scrollWatcherConstructor(document.querySelectorAll("[data-watch]"))}scrollWatcherConstructor(e){if(e.length){this.scrollWatcherLogging(`Проснулся, слежу за объектами (${e.length})...`),o(Array.from(e).map((function(e){if("navigator"===e.dataset.watch&&!e.dataset.watchThreshold){let t;e.clientHeight>2?(t=window.innerHeight/2/(e.clientHeight-1),t>1&&(t=1)):t=1,e.setAttribute("data-watch-threshold",t.toFixed(2))}return`${e.dataset.watchRoot?e.dataset.watchRoot:null}|${e.dataset.watchMargin?e.dataset.watchMargin:"0px"}|${e.dataset.watchThreshold?e.dataset.watchThreshold:0}`}))).forEach((t=>{let r=t.split("|"),a={root:r[0],margin:r[1],threshold:r[2]},o=Array.from(e).filter((function(e){let t=e.dataset.watchRoot?e.dataset.watchRoot:null,r=e.dataset.watchMargin?e.dataset.watchMargin:"0px",o=e.dataset.watchThreshold?e.dataset.watchThreshold:0;if(String(t)===a.root&&String(r)===a.margin&&String(o)===a.threshold)return e})),s=this.getScrollWatcherConfig(a);this.scrollWatcherInit(o,s)}))}else this.scrollWatcherLogging("Сплю, нет объектов для слежки. ZzzZZzz")}getScrollWatcherConfig(e){let t={};if(document.querySelector(e.root)?t.root=document.querySelector(e.root):"null"!==e.root&&this.scrollWatcherLogging(`Эмм... родительского объекта ${e.root} нет на странице`),t.rootMargin=e.margin,!(e.margin.indexOf("px")<0&&e.margin.indexOf("%")<0)){if("prx"===e.threshold){e.threshold=[];for(let t=0;t<=1;t+=.005)e.threshold.push(t)}else e.threshold=e.threshold.split(",");return t.threshold=e.threshold,t}this.scrollWatcherLogging("йой, настройки data-watch-margin нужно сдавать в PX или %")}scrollWatcherCreate(e){this.observer=new IntersectionObserver(((e,t)=>{e.forEach((e=>{this.scrollWatcherCallback(e,t)}))}),e)}scrollWatcherInit(e,t){this.scrollWatcherCreate(t),e.forEach((e=>this.observer.observe(e)))}scrollWatcherIntersecting(e,t){e.isIntersecting?(!t.classList.contains("_watcher-view")&&t.classList.add("_watcher-view"),this.scrollWatcherLogging(`Я вижу ${t.classList}, добавил класс _watcher-view`)):(t.classList.contains("_watcher-view")&&t.classList.remove("_watcher-view"),this.scrollWatcherLogging(`Я не вижу ${t.classList}, убрал класс _watcher-view`))}scrollWatcherOff(e,t){t.unobserve(e),this.scrollWatcherLogging(`Я перестал следить за ${e.classList}`)}scrollWatcherLogging(e){this.config.logging&&a(`[Наблюдатель]: ${e}`)}scrollWatcherCallback(e,t){const r=e.target;this.scrollWatcherIntersecting(e,r),r.hasAttribute("data-watch-once")&&e.isIntersecting&&this.scrollWatcherOff(r,t),document.dispatchEvent(new CustomEvent("watcherCallback",{detail:{entry:e}}))}}({});let i=!1;setTimeout((()=>{if(i){let e=new Event("windowScroll");window.addEventListener("scroll",(function(t){document.dispatchEvent(e)}))}}),0);new class{constructor(e){this.type=e}init(){this.оbjects=[],this.daClassname="_dynamic_adapt_",this.nodes=[...document.querySelectorAll("[data-da]")],this.nodes.forEach((e=>{const t=e.dataset.da.trim().split(","),r={};r.element=e,r.parent=e.parentNode,r.destination=document.querySelector(`${t[0].trim()}`),r.breakpoint=t[1]?t[1].trim():"767.98",r.place=t[2]?t[2].trim():"last",r.index=this.indexInParent(r.parent,r.element),this.оbjects.push(r)})),this.arraySort(this.оbjects),this.mediaQueries=this.оbjects.map((({breakpoint:e})=>`(${this.type}-width: ${e/16}em),${e}`)).filter(((e,t,r)=>r.indexOf(e)===t)),this.mediaQueries.forEach((e=>{const t=e.split(","),r=window.matchMedia(t[0]),a=t[1],o=this.оbjects.filter((({breakpoint:e})=>e===a));r.addEventListener("change",(()=>{this.mediaHandler(r,o)})),this.mediaHandler(r,o)}))}mediaHandler(e,t){e.matches?t.forEach((e=>{this.moveTo(e.place,e.element,e.destination)})):t.forEach((({parent:e,element:t,index:r})=>{t.classList.contains(this.daClassname)&&this.moveBack(e,t,r)}))}moveTo(e,t,r){t.classList.add(this.daClassname),"last"===e||e>=r.children.length?r.append(t):"first"!==e?r.children[e].before(t):r.prepend(t)}moveBack(e,t,r){t.classList.remove(this.daClassname),void 0!==e.children[r]?e.children[r].before(t):e.append(t)}indexInParent(e,t){return[...e.children].indexOf(t)}arraySort(e){"min"===this.type?e.sort(((e,t)=>e.breakpoint===t.breakpoint?e.place===t.place?0:"first"===e.place||"last"===t.place?-1:"last"===e.place||"first"===t.place?1:0:e.breakpoint-t.breakpoint)):e.sort(((e,t)=>e.breakpoint===t.breakpoint?e.place===t.place?0:"first"===e.place||"last"===t.place?1:"last"===e.place||"first"===t.place?-1:0:t.breakpoint-e.breakpoint))}}("max").init();const c=((e,t)=>{let r=!0;return(...a)=>{r&&(r=!1,setTimeout((()=>{r=!0}),t),e.call(void 0,a))}})((e=>console.log(e)),1e3);document.getElementById("debounce")?.addEventListener("input",(e=>{c(e.target.value)})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector(".form-wrapper__form"),t=document.getElementById("sendForm");e.addEventListener("submit",(async e=>{e.preventDefault(),t.innerHTML="Отправка...",t.classList.add("sending");try{const t=new FormData(e.target),[r,a,o]=[t.get("name"),t.get("email"),t.get("phone")];if(!r||!a||!o)throw new Error("Все поля обязательны для заполнения");const s=await fetch("https://api-demo.rednosed.agency/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r,email:a,phone:o,token:"longTokenJWT"}),mode:"no-cors"});if(!s.ok){const e=await s.text();throw new Error(`Ошибка сервера: ${e}`)}const n=await s.json();return e.target.reset(),console.log("Данные успешно отправлены!"),n}catch(e){console.error("Ошибка при отправке формы:",e)}finally{t.innerHTML="Отправить",t.classList.remove("sending")}}));const r=document.querySelector(".header"),a=document.getElementById("getCamera"),o=document.getElementById("getVideo"),s=document.querySelector("#closeVideo"),n=document.querySelector(".result"),i=document.querySelector(".home__video-container"),c=document.querySelector(".info-home__checkbox"),l=document.querySelector(".result__button-text");function d(e){const t=document.createElement("div");t.classList="info-home__error-message",t.textContent=e,document.querySelector(".info-home__button div")||a.parentNode.insertBefore(t,a.nextSibling)}c.addEventListener("change",(()=>{c.checked?c.nextElementSibling.style.color="#000":c.nextElementSibling.style.color="red"})),a.addEventListener("click",(async()=>{if(c.checked){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return console.error("Доступ к камере не поддерживается"),void d("Доступ к камере не поддерживается в вашем браузере");try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}},audio:!1});o.srcObject=e;try{await o.play(),o&&(i.classList.add("show"),s.addEventListener("click",(()=>{e.getTracks().forEach((e=>e.stop()));let t=100*Math.random();document.querySelector(".result__persent span").innerHTML=t||73,i.classList.remove("show"),n.classList.add("show"),r.classList.add("hide"),setTimeout((()=>{l.innerHTML=t>=50?"У вас <span>высокий</span> уровень ереси<br>\n\t\t\t\tВы должны посетить храм и отплатить прошение<br>\n\t\t\t\tВ противном случае будет наложен административный штраф до 30 тыс.руб":"У вас <span>Низкий</span> уровень ереси<br>\n\t\t\t\tИспортите день архиепископу и повысьте его<br>\n\t\t\t\tВ противном случае будете подлежать анаферме!",l.style.display="block"}),3e3)})))}catch(e){console.error("Ошибка воспроизведения видео:",e),d("Не удалось запустить камеру")}}catch(e){switch(console.error("Ошибка доступа к камере:",e),e.name){case"NotAllowedError":d("Для работы приложения необходимо разрешить доступ к камере");break;case"NotFoundError":d("Камера не найдена");break;case"OverconstrainedError":d("Не удалось настроить камеру с выбранными параметрами");break;default:d("Произошла ошибка при попытке доступа к камере")}}}else c.nextElementSibling.style.color="red"}))})),window.FLS=!0,function(e={viewPass:!1,autoHeight:!1}){if(document.body.addEventListener("focusin",(function(e){const t=e.target;"INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName||(t.hasAttribute("data-no-focus-classes")||(t.classList.add("_form-focus"),t.parentElement.classList.add("_form-focus")),n.removeError(t),t.hasAttribute("data-validate")&&n.removeError(t))})),document.body.addEventListener("focusout",(function(e){const t=e.target;"INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName||(t.hasAttribute("data-no-focus-classes")||(t.classList.remove("_form-focus"),t.parentElement.classList.remove("_form-focus")),t.hasAttribute("data-validate")&&n.validateInput(t))})),e.viewPass&&document.addEventListener("click",(function(e){let t=e.target;if(t.closest('[class*="__viewpass"]')){let e=t.classList.contains("_viewpass-active")?"password":"text";t.parentElement.querySelector("input").setAttribute("type",e),t.classList.toggle("_viewpass-active")}})),e.autoHeight){const t=document.querySelectorAll("textarea[data-autoheight]");if(t.length){function r(e,t){e.style.height=`${t}px`}t.forEach((e=>{const t=e.hasAttribute("data-autoheight-min")?Number(e.dataset.autoheightMin):Number(e.offsetHeight),a=e.hasAttribute("data-autoheight-max")?Number(e.dataset.autoheightMax):1/0;r(e,Math.min(t,a)),e.addEventListener("input",(()=>{e.scrollHeight>t&&(e.style.height="auto",r(e,Math.min(Math.max(e.scrollHeight,t),a)))}))}))}}}({viewPass:!1,autoHeight:!1}),function(){const t=document.forms;if(t.length)for(const e of t)e.addEventListener("submit",(function(e){r(e.target,e)})),e.addEventListener("reset",(function(e){const t=e.target;n.formClean(t)}));async function r(e,t){if(0===(e.hasAttribute("data-no-validate")?0:n.getErrors(e))){if(e.hasAttribute("data-ajax")){t.preventDefault();const r=e.getAttribute("action")?e.getAttribute("action").trim():"#",a=e.getAttribute("method")?e.getAttribute("method").trim():"GET",s=new FormData(e);e.classList.add("_sending");const n=await fetch(r,{method:a,body:s});if(n.ok){let t=await n.json();e.classList.remove("_sending"),o(e,t)}else alert("Помилка"),e.classList.remove("_sending")}else e.hasAttribute("data-dev")&&(t.preventDefault(),o(e))}else if(t.preventDefault(),e.querySelector("._form-error")&&e.hasAttribute("data-goto-error")){const t=e.dataset.gotoError?e.dataset.gotoError:"._form-error";s(t,!0,1e3)}}function o(t,r=""){document.dispatchEvent(new CustomEvent("formSent",{detail:{form:t}})),setTimeout((()=>{if(e.popup){const r=t.dataset.popupMessage;r&&e.popup.open(r)}}),0),n.formClean(t),a(`[Формы]: ${"Форма отправлена!"}`)}}(),function(){function e(e){let t=e||document.querySelectorAll("[data-digits-counter]");t.length&&t.forEach((e=>{e.hasAttribute("data-go")||(e.setAttribute("data-go",""),e.dataset.digitsCounter=e.innerHTML,e.innerHTML="0",function(e){let t=null;const r=parseFloat(e.dataset.digitsCounterSpeed)?parseFloat(e.dataset.digitsCounterSpeed):1e3,a=parseFloat(e.dataset.digitsCounter),o=e.dataset.digitsCounterFormat?e.dataset.digitsCounterFormat:" ",s=0,n=i=>{t||(t=i);const c=Math.min((i-t)/r,1),l=Math.floor(c*(s+a));e.innerHTML=void 0!==e.dataset.digitsCounterFormat?function(e,t=" "){return e.toString().replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,`$1${t}`)}(l,o):l,c<1?window.requestAnimationFrame(n):e.removeAttribute("data-go")};window.requestAnimationFrame(n)}(e))}))}document.addEventListener("watcherCallback",(function(t){const r=t.detail.entry.target;r.querySelectorAll("[data-digits-counter]").length&&e(r.querySelectorAll("[data-digits-counter]"))}))}()})();